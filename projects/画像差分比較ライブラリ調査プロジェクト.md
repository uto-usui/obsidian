# 画像差分比較ライブラリ調査プロジェクト

## 1. 目的

SaaSを利用せずにVisual Regression Testing (VRT) を自前で実装することを想定し、画像の差分比較に使用できるライブラリや技術を調査・選定する。特に、純粋な画像比較機能に焦点を当てる。

## 2. 調査対象と方針

Node.jsまたはブラウザ環境で動作することを前提とする。ライブラリの利用だけでなく、部分的な自前実装も選択肢として検討する。

### 2.1. 調査対象ライブラリ (Node.js / Browser)

- **`pixelmatch`**: ピクセル単位での比較に特化した、軽量で高速なライブラリ。
- **`resemble.js`**: 画像の差分を解析し、視覚的な差分画像を生成できる。アンチエイリアシングの検出など、より高度な機能を持つ。
- **`looks-same`**: 様々な指標（厳密、知覚的）で画像の類似性を判断できる。差分領域のハイライトも可能。

### 2.2. 自前実装の場合の検討項目

- **画像データの取得:**
    - **ブラウザ:** `Canvas API` の `getImageData()` を利用してピクセルデータ（`Uint8ClampedArray`）を取得する。
    - **Node.js:** `canvas` パッケージや `sharp` などのライブラリを利用して画像データを読み込む。
- **比較アルゴリズム:**
    - **ピクセル単位の完全一致:** RGBA値を単純比較する。
    - **閾値（Threshold）の設定:** 色の差異がある程度の許容範囲内であれば一致とみなすロジック。
    - **アンチエイリアシングの考慮:** 境界線のぼやけをどう扱うか。
- **差分の可視化:**
    - `Canvas API` の `putImageData()` を利用し、差分のあるピクセルを特定の色で塗りつぶした新しい画像を生成する。

## 3. 評価観点

- **比較精度:** ピクセル単位の完全一致か、人間が知覚する類似性を考慮できるか。
- **差分の可視化:** 差分をハイライトした画像を生成する機能の有無と、その分かりやすさ。
- **パフォーマンス:** 大量の画像を高速に処理できるか。
- **依存関係と環境:** ブラウザネイティブで動作するか、Node.jsの特定のライブラリに依存するか。
- **導入/実装の容易さ:**
    - **ライブラリ:** インストールや基本的な使い方がシンプルか。
    - **自前実装:** 実装の複雑さや必要なコード量。
- **ドキュメントとコミュニティ:** ドキュメントや用例が充実しているか、活発にメンテナンスされているか。

## 4. 調査の進め方

1.  各ライブラリの公式ドキュメントやGitHubリポジトリを確認し、上記の評価観点に基づいて情報を整理する。
2.  ブラウザの `Canvas API` を用いた基本的な画像比較処理をプロトタイピングし、実装の感触を掴む。
3.  各ライブラリと自前実装のプロトタイプについて、簡単なサンプルコードで同じ画像ペアを比較し、結果（精度、速度、差分画像）を評価する。
4.  それぞれの長所・短所をまとめ、VRT実装のコンテキストで最適なアプローチ（ライブラリ利用、自前実装、またはその組み合わせ）を結論づける。
